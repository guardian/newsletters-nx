allowedStages:
  - CODE
  - PROD
deployments:
  asg-upload-eu-west-1-newsletters-newsletters-tool:
    type: autoscaling
    actions:
      - uploadArtifacts
    regions:
      - eu-west-1
    stacks:
      - newsletters
    app: newsletters-tool
    parameters:
      bucketSsmLookup: true
      prefixApp: true
    contentDirectory: newsletters-tool
  cfn-eu-west-1-newsletters-newsletters-tool:
    type: cloud-formation
    regions:
      - eu-west-1
    stacks:
      - newsletters
    app: newsletters-tool
    contentDirectory: cdk.out
    parameters:
      templateStagePaths:
        CODE: NewslettersTool-CODE.template.json
        PROD: NewslettersTool-PROD.template.json
      amiParameter: AMINewsletterstool
      amiTags:
        BuiltBy: amigo
        Recipe: newsletters-node
        AmigoStage: PROD
    dependencies:
      - asg-upload-eu-west-1-newsletters-newsletters-tool
  asg-update-eu-west-1-newsletters-newsletters-tool:
    type: autoscaling
    actions:
      - deploy
    regions:
      - eu-west-1
    stacks:
      - newsletters
    app: newsletters-tool
    parameters:
      bucketSsmLookup: true
      prefixApp: true
    dependencies:
      - cfn-eu-west-1-newsletters-newsletters-tool
    contentDirectory: newsletters-tool
  asg-upload-eu-west-1-newsletters-api-newsletters-tool:
    type: autoscaling
    actions:
      - uploadArtifacts
    regions:
      - eu-west-1
    stacks:
      - newsletters-api
    app: newsletters-tool
    parameters:
      bucketSsmLookup: true
      prefixApp: true
    contentDirectory: newsletters-tool
  cfn-eu-west-1-newsletters-api-newsletters-api:
    type: cloud-formation
    regions:
      - eu-west-1
    stacks:
      - newsletters-api
    app: newsletters-api
    contentDirectory: cdk.out
    parameters:
      templateStagePaths:
        CODE: NewslettersApi-CODE.template.json
        PROD: NewslettersApi-PROD.template.json
      amiParameter: AMINewsletterstool
      amiTags:
        BuiltBy: amigo
        Recipe: newsletters-node
        AmigoStage: PROD
    dependencies:
      - asg-upload-eu-west-1-newsletters-api-newsletters-tool
  asg-update-eu-west-1-newsletters-api-newsletters-tool:
    type: autoscaling
    actions:
      - deploy
    regions:
      - eu-west-1
    stacks:
      - newsletters-api
    app: newsletters-tool
    parameters:
      bucketSsmLookup: true
      prefixApp: true
    dependencies:
      - cfn-eu-west-1-newsletters-api-newsletters-api
    contentDirectory: newsletters-tool
