$schema: 'https://raw.githubusercontent.com/guardian/riff-raff/master/contrib/riff-raff-yaml-schema.json'
stacks: [newsletters]
regions: [eu-west-1]
allowedStages: [CODE] # TODO: add PROD stage
templates:
  cloudformation-template:
    type: cloud-formation
    parameters:
      cloudFormationStackByTags: false
      prependStackToCloudFormationStackName: false
      amiTags:
        Recipe: newsletters-node
        AmigoStage: PROD
  autoscaling-template:
    type: autoscaling
    parameters:
      bucketSsmLookup: true
deployments:
  # Newsletters internal tool cloudformation deployment
  newsletters-tool-cfn:
    template: cloudformation-template
    app: newsletters-tool
    parameters:
      cloudFormationStackName: newsletters-tool
      amiParameter: AMINewsletterstool # please don't change this unless you know what you're doing
      templateStagePaths:
        CODE: NewslettersTool-CODE.template.json # TODO: add PROD stage path
  # Newsletters internal tool autoscaling deployment
  newsletters-tool:
    template: autoscaling-template
    dependencies: [newsletters-tool-cfn]

  # Need to restrict riffraff deployment to do API OR Tool but not both...

  # Newsletters API cloudformation deployment
  # newsletters-api-cfn:
  #   template: cloudformation-template
  #   app: newsletters-api
  #   parameters:
  #     cloudFormationStackName: newsletters-api
  #     amiParameter: AMINewslettersapi # please don't change this unless you know what you're doing
  #     templateStagePaths:
  #       CODE: NewslettersApi-CODE.template.json # TODO: add PROD stage path
  # # Newsletters API autoscaling deployment
  # newsletters-api:
  #   template: autoscaling-template
  #   dependencies: [newsletters-api-cfn]
