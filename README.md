# NewslettersNx

This is a monorepo for:

-   defining the data model for editorial newsletters at the Guardian
-   serving an API to access the newsletter data
-   serving a user interface for editorial to manage their newsletters
-   the state-machine library used between UI and API

## Running locally

To run the UI and API locally with the default options:

### Run set-up script

```bash
./scripts/setup.sh
```

### Run the app

`npm run dev`

See the documentation for the [API](apps/newsletters-api/README.md) for the configuration options.

## UI Tool Deployment and Access

The newsletters-tool is deployed to PROD, (ðŸ›  currently as a demo only, using test data):
https://newsletters-tool.gutools.co.uk/

CODE environment (for testing) deployed to:
https://newsletters-tool.code.dev-gutools.co.uk/

Continuous Integration (CI) is configured on this Repo. Merging to main will trigger redeployment to of PROD using [RiffRaff](https://riffraff.gutools.co.uk/). To deploy a build to CODE, push your branch to github and create a PR (draft will do). The build can be selected and deployed from [RiffRaff's deploy page](https://riffraff.gutools.co.uk/deployment/request) (project=newsletters::newsletters-tool).

Users need to log to a Guardian account in using google auth to access the UI. The web application auth configuration in the google console can be accessed (requires membership of the newsletters admin group) at
https://console.cloud.google.com/apis/credentials?project=newsletter-source-api

## Nx

âœ¨ **This workspace has been generated by [Nx, a Smart, fast and extensible build system.](https://nx.dev)** âœ¨

### Understand this workspace

Run `nx graph` to see a diagram of the dependencies of the projects.

### Remote caching

Run `npx nx connect-to-nx-cloud` to enable [remote caching](https://nx.app) and make CI faster.

**NOTE** - we decided to not use remote caching to simplify the set-up and to avoid uncertainty on how to best manange the user account needed to 'claim' the Workspace in nx-cloud. See https://nx.dev/core-features/share-your-cache#connecting-your-workspace-to-your-nx-cloud-account

Remote caching had been set up and was working without 'claiming' the workspace, but an unexpected change in nx policy(?) caused [CI errors](https://github.com/guardian/newsletters-nx/actions/runs/5043176034/jobs/9044634561?pr=136) of:

`"NX Error when connecting to Nx Cloud. Code: 401. Error: This workspace is more than a week old and is unclaimed. Workspaces must be claimed within 7 days of creation.."`

### Further help

Visit the [Nx Documentation](https://nx.dev) to learn more.
